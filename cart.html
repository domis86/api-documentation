<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musement API Doc</title>

    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic'
          rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="http://thack.musement.com/thack_api/css/theme.css" type="text/css"/>
    <link rel="stylesheet" href="http://thack.musement.com/thack_api/css/theme-fixes.css" type="text/css"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
</head>
<body class="wy-body-for-nav">

    <div class="wy-grid-for-nav">

        <nav data-toggle="wy-nav-shift" class="wy-nav-side">
            <div class="wy-side-nav-search">
                <a href="http://thack.musement.com/thack_api/" class="fa fa-home"> Musement API Doc</a>
            </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://thack.musement.com/thack_api/authentication.html">
                                Authentication
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://thack.musement.com/thack_api/catalog.html">
                                Catalog
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://thack.musement.com/thack_api/booking.html">
                                Booking
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://thack.musement.com/thack_api/cart.html">
                                Cart
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://thack.musement.com/thack_api/customer.html">
                                Customer
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://thack.musement.com/thack_api/search.html">
                                Search
                            </a>
                        </li>
                                            <li class="toctree-l1 ">
                            <a class="reference internal "
                               href="http://thack.musement.com/thack_api/glossary.html">
                                Glossary
                            </a>
                        </li>
                                    </ul>
            </div>
            &nbsp;
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

                        <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
                <a href="http://thack.musement.com/thack_api/">Musement API Doc</a>
            </nav>


                        <div class="wy-nav-content">
                <div class="rst-content">
                    <div role="main" class="document">
                        <h2 id="cart">Cart</h2>
<h3 id="create-the-cart">Create the Cart</h3>
<p><strong>NOTE</strong></p>
<ul>
<li>All calls to carts endpoints return a <em>Cart</em>, see <code>GET /api/v3/carts/{id}</code> for details.</li>
</ul>
<p>Creating a new <em>Cart</em> is as easy as sending a <code>POST</code> to the <code>/api/v3/carts</code> endpoint. The information needed to create a cart is divided in two groups: those related to the <em>Tickets</em> and those related to the <em>Customer</em>.</p>
<pre><code>POST /api/v3/carts

{
  "tickets":[
   {
     "product": {
      "id": 8216618
     },
     "quantity":2,
     "metadata":{"language":"es"}
   }
  ]
}</code></pre>
<p>Of course you can also add more items with a single call</p>
<pre><code>POST /api/v3/carts

{
 "tickets":[
  {
    "product": {
     "id": 8216618
    },
    "quantity": 2,
    "metadata":{"language":"es"}
  },
  {
    "product": {
      "id": 7372773
    },
    "quantity": 12
  }
 ]
}</code></pre>
<h4 id="add-info-to-a-cart">Add info to a cart</h4>
<p>Once a cart is created you can add information sending <code>PATCH</code> to the endpoint <code>/api/v3/carts/{id}</code>.</p>
<p><em>A call that add customer data to an existing cart</em></p>
<pre><code>PATCH /api/v3/carts/{id}

{
  "customer" : {
    "email": "guest136a@fakemail.com",
    "firstname": "Guest136a",
    "lastname": "surname136a",
    "country": {
      "id": 123
    }
  }
}</code></pre>
<p><strong>NOTE</strong></p>
<ul>
<li><code>email</code>, <code>firstname</code>, <code>lastname</code> and <code>country</code> are all mandatory.</li>
<li>For the list of available countries <a href="https://thack.musement.com/documentation#get--api-v3-countries.{_format}">see</a></li>
</ul>
<h4 id="updatechange-info-in-a-cart">Update/change info in a cart</h4>
<p>To completely replace the data in the cart you must use <code>PUT</code> verbs and pass the full new payload.</p>
<pre><code>PUT /api/v3/carts/{id}

{
    "tickets":[
      {
        "product": {
          "id": 8216618
        },
        "quantity":3,
        "metadata":{"language":"fr"}
      }     
    ],
    "customer" : {
      "email": "guest136a@fakemail.com",
      "firstname": "Guest136a",
      "lastname": "surname136a",
      "country": {
        "id": 123
    }
  }
}</code></pre>
<blockquote>
<p>The main difference between PUT and PATCH is that with the first you will update the model of the cart with the body you send, with the PATCH you will update just the field you send in body. </p>
</blockquote>
<h4 id="retrive-the-cart">Retrive the cart</h4>
<h4><em>Request</em></h4>
<p><code>GET /api/v3/carts/{id}</code></p>
<pre><code>{
  "id": 1,
  "tickets": [
    {
      "product": {
        "id": "4488624",
        "type": "musement",
        "title": "Torre Eiffel: biglietti salta-la-coda con accesso sommità",
        "datetime": "2015-08-27T17:30:00+0000",
        "tourist_category": "Prezzo intero",
        "activity_name": "Ingresso",
        "event": {
          "id": 2700,
          "title": "Torre Eiffel: biglietti salta-la-coda con accesso sommità"
        },
        "image": "https://static1.musement.com/cover/0001/19/skip-the-line-tickets-to-the-eiffel-tower-with-summit-acc..."
      },
      "code": "BLU27-08-17-92138",
      "quantity": 1,
      "metadata": {},
      "status": "PENDING",
      "vouchers": []
    }
  ],
  "retail_price": {
    "currency": "EUR",
    "value": 26.6,
    "formatted_value": "€ 26.60"
  }
}</code></pre>
<h4 id="extra-info-needed-for-cart">Extra info needed for cart</h4>
<p>Once the cart has items and customer information, depending on the items you have in the cart, some extra info might be needed to complete the purchase.</p>
<p>To retrieve this info you need to call <code>GET /api/v3/carts/{id}/form</code> </p>
<p>With this form you can retrieve all information needed for a successful booking, there are three big categories:</p>
<ul>
<li>Customer Data - Standard info related to the customer</li>
<li>Extended Fields - Custom info related to the customer </li>
<li>Passenger Info - Info <em>for each</em> passanger</li>
</ul>
<pre><code>{
  "children": {
    "firstname": {
      "type": "text",
      "required": true,
      "label": "Name"
    },
    "lastname": {
      "type": "text",
      "required": true,
      "label": "Surname"
    },
    "email": {
      "children": {
        "email": {
          "type": "email",
          "required": true,
          "label": "Email Address"
        },
        "email_confirm": {
          "type": "email",
          "required": true,
          "label": "Confirm Email"
        }
      },
      "type": "repeated",
      "required": true,
      "label": "Email Address"
    },
    "customer_data": {
      "children": {
        "do_you_need_invoice": {
          "type": "checkbox",
          "required": false,
          "label": "Do you need an invoice?"
        },
        "birthdate": {
          "type": "date",
          "required": false,
          "label": "Date of birth"
        },
        "country": {
          "type": "entity",
          "required": true,
          "label": "Country"
        },
        "city": {
          "type": "text",
          "required": false,
          "label": "City"
        },
        "address": {
          "type": "text",
          "required": false,
          "label": "Address"
        },
        "zipcode": {
          "type": "text",
          "required": false,
          "label": "ZIP Code"
        },
        "mobile": {
          "type": "number",
          "required": false,
          "label": "Mobile #"
        },
        "id_number": {
          "type": "text",
          "required": false,
          "label": "Passport number"
        }
      },
      "type": "musement_user_customer_data",
      "required": true,
      "label": "Customer data"
    },
    "extended_fields": {
      "children": {
        "2700": {
          "children": {
            "159": {
              "children": {
                "phone_number": {
                  "type": "text",
                  "required": true,
                  "label": "Phone number"
                }
              },
              "type": "form",
              "required": true,
              "label": "text.profile.159"
            }
          },
          "type": "form",
          "required": true,
          "label": "text.profile.2700"
        }
      },
      "type": "form",
      "required": true,
      "label": "Extended fields"
    }
  }
}</code></pre>
<p>Just required fields are needed for a successful booking. With a response like the previous one, you have to update your cart with this body:</p>
<pre><code>{
  "firstname": "Guest136a",
  "lastname": "surname136a",
  "email": "guest136a@fakemail.com",
  "customer_data": 
  {
    "country": {
      "id": 123
    }
  },
  "extended_fields": {
    "phone_number": 123
  }
}</code></pre>
                    </div>

                    <footer>
                        <hr/>
                                                Built with <a href="http://couscous.io/">Couscous</a> using a <a href="https://github.com/CouscousPHP/Template-ReadTheDocs">theme</a> based on <a href="https://readthedocs.org/">Read the Docs</a>.
                    </footer>

                </div>
            </div>

        </section>

    </div>

    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script src="http://thack.musement.com/thack_api/js/theme.js"></script>

    <script>
        $(function() {
            // Syntax highlighting
            hljs.initHighlightingOnLoad();
        });
    </script>

</body>
</html>
